---
layout: post
title: Win 10 IoT Core
date: '2017-11-18T23:02:00.001+09:00'
author: 'Contact:'
tags:
- iot
- raspi
- iotcore
- win10
modified_time: '2017-11-23T18:01:53.139+09:00'
thumbnail: https://4.bp.blogspot.com/-DUhAoALb9Ok/WhA6_dC4ZSI/AAAAAAAACxc/SGKWiX1ylLgCDQHqUQOxVA7dCLgR6BFnACLcBGAs/s72-c/Screen%2BShot%2B2017-11-18%2Bat%2B18.24.16.png
blogger_id: tag:blogger.com,1999:blog-5371326417913853395.post-933929094128534125
blogger_orig_url: http://rendered-obsolete.blogspot.com/2017/11/win-10-iot-core.html
---

Recently been looking at using a <a href="https://www.raspberrypi.org/">Raspberry Pi 3</a> for a modestly work-related project.<br /><br />Since the rest of our platform is running on Windows 10 IoT Enterprise (aka Windows 10 Enterprise LTSB), I thought I'd give <a href="https://developer.microsoft.com/en-us/windows/iot">IoT Core</a> a look in the hopes that almost no porting would be required.&nbsp; The <a href="https://docs.microsoft.com/en-us/windows/iot-core/learn-about-hardware/hardwarecompatlist">hardware compatibility list</a>&nbsp;deserves special mention here because there is far more RaspPi accessories available than are actually supported by Win10.<br /><br />For various reasons I'm not going to have hardware for over a month, so I'm trying to give things a whirl via&nbsp;<a href="https://www.virtualbox.org/wiki/Downloads">virtualbox</a>.&nbsp;&nbsp;<a href="https://www.newventuresoftware.com/blog/running-windows-10-iot-core-in-a-virtual-machine">This blog post</a> seems to be referenced numerous places as the reference to get an x86/x64 ISO of IoT Core running in a VM.&nbsp; But, between using some tool from the XNA developer forums and glossing over several details I started looking for other sources.<br /><br /><a href="http://autosqa.com/blog/index.php/2016/04/14/how-to-run-windows-10-iot-core-in-vmware-workstation/">This post</a>&nbsp;from a year and a half ago gave me another view as it goes over running IoT Core in VMWare.&nbsp; It pointed me towards investigating VHD and <a href="https://docs.microsoft.com/en-us/windows-hardware/manufacture/desktop/dism-image-management-command-line-options-s14">dism</a>.&nbsp; A series of MS blogs also gave me a bit better understanding of their usage: <a href="https://blogs.technet.microsoft.com/jamesone/2009/05/26/how-to-work-with-vhd-files-at-the-command-line/">this</a>, <a href="https://blogs.technet.microsoft.com/jamesone/2009/05/26/how-to-customize-windows-images-with-dism/">this</a>, and <a href="https://blogs.technet.microsoft.com/jamesone/2009/05/27/how-to-install-an-image-onto-a-vhd-file/">this</a>.<br /><br />What follows is what I did in the end to get things running.<br /><h2>Installation</h2><h3></h3><h3>Image Creation</h3><div><br />Start by <a href="https://developer.microsoft.com/en-us/windows/iot">downloading IoT Core</a>.&nbsp; You want the ISO for MinnowBoard MAX or whatever else is x64.&nbsp; Mount that and run the msi.&nbsp; Some stuff is installed to <i>c:\Program Files (x86)\Microsoft IoT\</i>.<br /><br />Next, need to create a VHD image:<br /><ol><li>Launch Disk Management</li><li>Action -&gt; Create VHD</li><ul><li>Enter a location for the file</li><li>Use 8 GB for "Virtual hard disk size"</li><li>I left everything else as default</li></ul><li>Note the name of the drive that was created (in my case it was "Disk 1")</li></ol>Now copy the IoT Core ffu image to the VHD:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> C:\&gt; dism /Apply-Image /Image-File:”C:\Program Files (x86)\Microsoft IoT\MinnowBoardMax_x64\flash.ffu” /ApplyDrive:\\.\PhysicalDrive1 /SkipPlatformCheck<br /></code></pre>Where PhysicalDriveN is the "Disk N"- the VHD.<br /><br />Once it finishes writing, right-click the drive in Disk Management and select "Detach VHD".<br /><h3></h3><h3>VM Configuration</h3></div><div><br /></div><div>In VirtualBox (I'm using 5.1.26), create a new VM:</div><div><ul><li>Version "Windows 10 (64-bit)"</li><li>Memory size 2048</li><li>"Use an existing virtual hard disk file" and browse to the VHD</li></ul><div>After the VM is created, right-click it and select "Settings".&nbsp; On the System tab check "<b>Enable EFI (special OSes only)</b>".</div></div><div><br /></div><div>Start the VM and after brief startup you should be greeted with:</div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-DUhAoALb9Ok/WhA6_dC4ZSI/AAAAAAAACxc/SGKWiX1ylLgCDQHqUQOxVA7dCLgR6BFnACLcBGAs/s1600/Screen%2BShot%2B2017-11-18%2Bat%2B18.24.16.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1300" data-original-width="1600" height="260" src="https://4.bp.blogspot.com/-DUhAoALb9Ok/WhA6_dC4ZSI/AAAAAAAACxc/SGKWiX1ylLgCDQHqUQOxVA7dCLgR6BFnACLcBGAs/s320/Screen%2BShot%2B2017-11-18%2Bat%2B18.24.16.png" width="320" /></a></div><div>Sweet, sweet victory!</div><h2></h2><h2>Detours</h2><div>There were a few miss-steps along the way.</div><div><br /></div><div>Despite every reference I found calling out the need to boot with EFI, I managed to overlook that by the time I finally got around to setting my VM up.&nbsp; Should you do the same, on startup the VM will fail immediately:<br /><br /></div><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> FATAL: No bootable medium found! System halted.  <br /></code></pre><br /><div class="p1">After that, once I enabled EFI I was dropped into a UEFI shell:<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-hsPIVXbSvIc/WhA0gzUAwZI/AAAAAAAACxM/kNBF6uZePJsv2P4ZkWoQLrw7zq9vSJZOQCLcBGAs/s1600/Screen%2BShot%2B2017-11-18%2Bat%2B21.23.12.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="858" data-original-width="1328" height="206" src="https://4.bp.blogspot.com/-hsPIVXbSvIc/WhA0gzUAwZI/AAAAAAAACxM/kNBF6uZePJsv2P4ZkWoQLrw7zq9vSJZOQCLcBGAs/s320/Screen%2BShot%2B2017-11-18%2Bat%2B21.23.12.png" width="320" /></a></div>Luckily, I stubbled upon the <a href="https://developer.microsoft.com/en-us/windows/iot/Docs/GetStarted/mbm/sdcard/stable/getstartedstep2">setup guide for the MinnowBoard MAX</a>&nbsp;which provided the necessary hint.&nbsp; Guessing that the first device listed was the correct device I tried:<br /><br /><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> Shell&gt; fs0:  <br /> fs0:&gt; efi\boot\bootia32.efi  <br /></code></pre><br />Only, it wasn't there.&nbsp; There was only an efi file for x64- it was trying to boot a 64-bit OS.&nbsp; I'd followed the old blogs and picked "Windows 10 (32-bit)" when setting up the VM.&nbsp; Nuking that VM and setting it up as "Windows 10 (64-bit)" like in the instructions above did the trick.<br /><br />Astute readers might have noticed my host OS is OSX.&nbsp; The Windows 10 portions were also done within the confines of VirtualBox.</div>