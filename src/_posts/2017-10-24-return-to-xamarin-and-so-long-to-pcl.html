---
layout: post
title: Return to Xamarin and So Long to PCL
date: '2017-10-24T15:47:00.003+09:00'
author: 'Contact:'
tags:
- c#
- xamarin
- netstandard
- uwp
- vs2017
- win10
modified_time: '2017-11-18T23:09:07.681+09:00'
thumbnail: https://3.bp.blogspot.com/-KnsVNVAiYDI/We7cD-J3fuI/AAAAAAAACww/aOgJ78Qp18Mr7pJlUAVHwLl8Wos-LcikQCPcBGAYYCw/s72-c/uwp_target.png
blogger_id: tag:blogger.com,1999:blog-5371326417913853395.post-1632052881694561717
blogger_orig_url: http://rendered-obsolete.blogspot.com/2017/10/return-to-xamarin-and-so-long-to-pcl.html
---

Working on a new project and using C# for the majority of the PC client.  We need a mobile app as well, so Xamarin seemed like the logical choice to maximize code reuse.  <br /><br />When previously working with Xamarin I was introduced to <a href="https://docs.microsoft.com/en-us/dotnet/standard/cross-platform/cross-platform-development-with-the-portable-class-library">PCL</a>.  But, I was forever running into problems with platforms I was targeting and the ones supported by packages on nuget.  <br /><br />Apparently well aware of its flaws Microsoft has since deprecated PCL in favor of <a href="https://docs.microsoft.com/en-us/dotnet/standard/net-standard">.Net Standard</a>.  We've started targeting the bleeding edge .Net Standard 2.0 since it provides the widest API coverage and meets our platform requirements.  What follows is my experience getting a multi-platform (initially just Android and UWP) Xamarin.Forms app using .Net Standard 2.0 building and running with <a href="https://www.visualstudio.com/downloads/">Visual Studio 2017 Community</a>.  <br /><h2><br /></h2><h2>Creation</h2>Using the VS 2017 new project wizard, there's currently no obvious way to create a Xamarin app that uses .Net Standard 2.0.  Under Other Languages, Visual C#, there's Cross Platform App (Xamarin).  Next, for UI Technology choose Xamarin.Forms and Code Sharing Strategy choose Portable Class Library (PCL).  From there the following two links got me started converting the PCL project to .Net Standard: <br /><ul><li><a href="https://xamarinhelp.com/visual-studio-2017-net-standard-xamarin/">Xamarin VS 2017 .Net Standard</a></li><li><a href="https://xamarinhelp.com/upgrade-pcl-net-standard-class-library/">Xamarin Upgrade PCL to .Net Standard</a></li></ul><h2><br /></h2><h2>Building</h2>Building for the first time resulted in a bunch of errors similar to the following: <pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> obj\Debug\netstandard2.0\mobile_app.AssemblyInfo.cs(14,12,14,54): error CS0579: Duplicate 'System.Reflection.AssemblyCompanyAttribute' attribute  <br /> obj\Debug\netstandard2.0\mobile_app.AssemblyInfo.cs(15,12,15,60): error CS0579: Duplicate 'System.Reflection.AssemblyConfigurationAttribute' attribute  <br /> obj\Debug\netstandard2.0\mobile_app.AssemblyInfo.cs(16,12,16,58): error CS0579: Duplicate 'System.Reflection.AssemblyDescriptionAttribute' attribute  <br /></code></pre>To fix this, I need to remove Properties/AssemblyInfo.cs from the project.  <pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> App.xaml.cs(6,7,6,14): error CS0246: The type or namespace name 'Xamarin' could not be found (are you missing a using directive or an assembly reference?)  <br /> MainPage.xaml.cs(6,7,6,14): error CS0246: The type or namespace name 'Xamarin' could not be found (are you missing a using directive or an assembly reference?)  <br /> App.xaml.cs(10,32,10,43): error CS0246: The type or namespace name 'Application' could not be found (are you missing a using directive or an assembly reference?)  <br /> MainPage.xaml.cs(10,37,10,48): error CS0246: The type or namespace name 'ContentPage' could not be found (are you missing a using directive or an assembly reference?)  <br /> App.xaml.cs(19,33,19,40): error CS0115: 'App.OnStart()': no suitable method found to override  <br /> App.xaml.cs(24,33,24,40): error CS0115: 'App.OnSleep()': no suitable method found to override  <br /> App.xaml.cs(29,33,29,41): error CS0115: 'App.OnResume()': no suitable method found to override  <br /></code></pre>For this, right-click VS project, Manage NuGet Packages, and add Xamarin.Forms.  <pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> error : Project 'mobile_app\mobile_app\mobile_app\mobile_app.csproj' targets '.NETStandard,Version=v2.0'. It cannot be referenced by a project that targets 'UAP,Version=v10.0.10586'.  <br /></code></pre>I couldn't just build a UWP application with .NetStandard 2.0, it <a href="https://blogs.msdn.microsoft.com/dotnet/2017/10/10/announcing-uwp-support-for-net-standard-2-0/">required upgrading Visual Studio 2017 to 15.4</a> and setting the Minimum Version of the UWP project to "Windows 10 Fall Creators Update" (may first need to set Target Version to the same).  <div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-KnsVNVAiYDI/We7cD-J3fuI/AAAAAAAACww/aOgJ78Qp18Mr7pJlUAVHwLl8Wos-LcikQCPcBGAYYCw/s1600/uwp_target.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="318" data-original-width="661" height="154" src="https://3.bp.blogspot.com/-KnsVNVAiYDI/We7cD-J3fuI/AAAAAAAACww/aOgJ78Qp18Mr7pJlUAVHwLl8Wos-LcikQCPcBGAYYCw/s320/uwp_target.png" width="320" /></a></div><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> Could not load file or assembly 'netstandard, Version=2.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51' or one of its dependencies. The system cannot find the file specified.  <br /> 'netstandard, Version=2.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51'  <br />   at System.ModuleHandle.ResolveType(RuntimeModule module, Int32 typeToken, IntPtr* typeInstArgs, Int32 typeInstCount, IntPtr* methodInstArgs, Int32 methodInstCount, ObjectHandleOnStack type)  <br />   at System.ModuleHandle.ResolveTypeHandleInternal(RuntimeModule module, Int32 typeToken, RuntimeTypeHandle[] typeInstantiationContext, RuntimeTypeHandle[] methodInstantiationContext)  <br />   at System.Reflection.RuntimeModule.ResolveType(Int32 metadataToken, Type[] genericTypeArguments, Type[] genericMethodArguments)  <br />   at System.Reflection.CustomAttribute.FilterCustomAttributeRecord(CustomAttributeRecord caRecord, MetadataImport scope, Assembly&amp; lastAptcaOkAssembly, RuntimeModule decoratedModule, MetadataToken decoratedToken, RuntimeType attributeFilterType, Boolean mustBeInheritable, Object[] attributes, IList derivedAttributes, RuntimeType&amp; attributeType, IRuntimeMethodInfo&amp; ctor, Boolean&amp; ctorHasParameters, Boolean&amp; isVarArg)  <br />   at System.Reflection.CustomAttribute.GetCustomAttributes(RuntimeModule decoratedModule, Int32 decoratedMetadataToken, Int32 pcaCount, RuntimeType attributeFilterType, Boolean mustBeInheritable, IList derivedAttributes, Boolean isDecoratedTargetSecurityTransparent)  <br />   at System.Reflection.CustomAttribute.GetCustomAttributes(RuntimeAssembly assembly, RuntimeType caType)  <br />   at System.Reflection.RuntimeAssembly.GetCustomAttributes(Type attributeType, Boolean inherit)  <br />   at System.Attribute.GetCustomAttributes(Assembly element, Type attributeType, Boolean inherit)  <br />   at System.Attribute.GetCustomAttribute(Assembly element, Type attributeType, Boolean inherit)  <br />   at System.Reflection.CustomAttributeExtensions.GetCustomAttribute[T](Assembly element)  <br />   at Microsoft.Build.Tasks.ProcessResourceFiles.ReadAssemblyResources(String name, String outFileOrDir)  <br /></code></pre>Updating Microsoft.NETCore.UniversalWindowsPlatform package to the latest version on nuget solved this.  There's also a warning about incompatible versions of Xamarin.Forms, but for that I just removed the reference to the old assembly from the UWP project.  <br /><h2><br /></h2><h2>Running</h2><pre style="background: #f0f0f0; border: 1px dashed #cccccc; color: black; font-family: &quot;arial&quot;; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> DEP3321: To deploy this application, your deployment target should be running Windows Universal Runtime version 10.0.16299.0 or higher. You currently are running version 10.0.15063.674. Please update your OS, or change your deployment target to a device with the appropriate version.  <br /></code></pre>Here we're targeting Fall Creators Update but I wasn't running it yet.  Previously I would have to enroll in <a href="https://insider.windows.com/en-us/how-to-pc/">Windows 10 Insider Preview</a>, but as of today Fall Creators Update is officially released.  Finally, I'm not sure if this is actually required for UWP apps, but it's needed for Android so I'll mention it here anyway.  Xaml files need to be available at runtime, so right-click each and in Properties set "Build Action" to "Embedded resource".  <br /><br /><br /><br />