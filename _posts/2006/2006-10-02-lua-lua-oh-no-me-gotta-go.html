---
layout: post
title: Lua, Lua... Oh no! Me gotta go
date: '2006-10-02T01:45:00.000+09:00'
author: 'Contact:'
tags:
- dev
- lua
modified_time: '2006-10-02T02:22:49.910+09:00'
blogger_id: tag:blogger.com,1999:blog-5371326417913853395.post-5684542288763810680
blogger_orig_url: http://rendered-obsolete.blogspot.com/2006/10/lua-lua-oh-no-me-gotta-go.html
---

Been messing around with <a href="http://www.lua.org/">Lua</a> a bit the last few days.  Can't remember how I came across it but it's performance against other languages (<a href="http://shootout.alioth.debian.org/">1</a>, <a href="http://dada.perl.it/shootout/">2</a>) made me decide to give it a serious look.  Particularly given how well it did against the dark lord Perl and my personal favorite, Python.  Found several other things where people remarked how easy it was to embed in C/C++ programs so I figured it was worth the time.<br /><br />Downloaded the 5.1.1 source from <a href="http://www.lua.org/">www.lua.org</a> and had it compiled under <a href="http://www.cygwin.com/">cygwin</a> in a matter of seconds without any problems.  Found a decent selection of <a href="http://lua-users.org/wiki/TutorialDirectory">tutorials</a>, and an <a href="http://www.lua.org/pil/index.html">online version of Programming in Lua</a> but found they were a bit thin when it came to embedding Lua in C.  Thought I hit the jackpot with <a href="http://www.debian-administration.org/articles/264">this writeup at debian.org</a> but was amazed to find out that it no longer worked despite being less than a year old.<br /><br />After an hour or two of (re-)reading the sources above, looking at header files, etc. I was able to figure out enough to get a demo working.  It's pretty slick.  You can write a C program like:<br /><pre class="code"><br />#include &lt;stdio.h&gt;<br />#include &lt;lua.h&gt;<br />#include &lt;lualib.h&gt;<br />#include &lt;lauxlib.h&gt;<br />int<br />main( int argc, char ** argv ){<br />int value = 1;<br /><br />// Initialize Lua<br />lua_State *L = lua_open();<br /><br />// Load various Lua libraries<br />luaopen_base( L );<br />luaopen_table( L );<br />//luaopen_io( L ); // Not sure why but I get a PANIC if i try to load this<br />luaopen_string( L );<br />luaopen_math( L );<br /><br />luaL_loadfile( L, "3.lua");<br />lua_pcall( L, 0, 0, 0 ); // Have to parse it once or getglobal() will fail<br /><br />printf( "C: value is %d\n", value );<br /><br />lua_getglobal( L, "test" );<br />lua_pushnumber( L, value );<br />lua_pcall( L, 1, 1, 0); // 1 argument, 1 result<br />value = (int)lua_tonumber( L, -1 ); // Lua arrays are 1-indexed /boggle<br /><br />printf( "C: value is %d\n", value );<br /><br />// Cleanup<br />lua_close( L );<br /><br />return 0;<br />}<br /></pre><br /><br />And then you create a script called 3.lua like:<br /><pre class="code">function test (x)<br />return (x + 1)<br />end<br /></pre><br /><br />And your output should be:<br /><pre>C: value is 1<br />C: value is 2<br /></pre><br /><br />Pretty slick.  Doesn't make the C program terribly huge, either.  The luaopen_*() functions load libraries which naturally increase the size of executable.  The plain C executable was about 8k, with the four libraries above about 130k, or with just "base" alone it was 114k.  OK, OK, so the executable is about 12x larger... it's still neat seeing as how you now have full access to a fairly powerful scripting engine without having to recompile.<br /><br />I'm positive I can put this to good use in at least one of my projects.  Why do I mention it here?  Saw a bunch of comments about it being used for scripting, etc. in various video games.... good stuff.