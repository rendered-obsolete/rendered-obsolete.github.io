<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Mapping touch-screen input to pixel values on the DS | Rendered Obsolete</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="Mapping touch-screen input to pixel values on the DS" />
<meta name="author" content="Contact:" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Finally got some school stuff out of the way so I can get back to the important things in life…. like the Nintendo DS.Been messing around with touch-screen input a bit. It was fairly easy to get a demo running, but when I started trying to drag something around I found out that the touch screen uses a different coordinate system from the display. Dug around a little bit and came up with:&lt;pre class=&quot;code&quot;&gt;#define SCREEN_WIDTH 256#define SCREEN_HEIGHT 192// those are pixel positions of the two points you click // when calibrating#define TOUCH_CNTRL_X1 ((vu8)0x027FFCDC)#define TOUCH_CNTRL_Y1 ((vu8)0x027FFCDD)#define TOUCH_CNTRL_X2 ((vu8)0x027FFCE2)#define TOUCH_CNTRL_Y2 ((vu8)0x027FFCE3)// those are the corresponding touchscreen values:#define TOUCH_CAL_X1 ((vu16)0x027FFCD8)#define TOUCH_CAL_Y1 ((vu16)0x027FFCDA)#define TOUCH_CAL_X2 ((vu16)0x027FFCDE)#define TOUCH_CAL_Y2 ((vu16)0x027FFCE0)// linear mapping can be used to go from touchscreen position to // pixel position// precalculate some valuesstatic int16 TOUCH_WIDTH = TOUCH_CAL_X2 - TOUCH_CAL_X1;static int16 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;static int16 CNTRL_WIDTH = TOUCH_CNTRL_X2 - TOUCH_CNTRL_X1;static int16 CNTRL_HEIGHT = TOUCH_CNTRL_Y2 - TOUCH_CNTRL_Y1;// reading pixel position:int16 x = (IPC-&gt;touchX - (int16) TOUCH_CAL_X1) * CNTRL_WIDTH / TOUCH_WIDTH + (int16) TOUCH_CNTRL_X1;int16 y = (IPC-&gt;touchY - (int16) TOUCH_CAL_Y1) * CNTRL_HEIGHT / TOUCH_HEIGHT + (int16) TOUCH_CNTRL_Y1;&lt;/pre&gt;at NDSTech Wiki. The needed calibration values don’t seem to be in ndslib so I think you need to define them yourself. Took around a minute of messing around to get a nice demo working where you could drag something around on screen just like you’d expect.Something I did in my code that’s worth pointing out is changing the calculations a bit to get rid of any extra operations (especially the division). Granted, I’m not sure how much the compiler can take care of, but it probably doesn’t hurt.First, if you separate the&lt;pre class=&quot;code&quot;&gt;IPC-&gt;touchX - (int16) TOUCH_CAL_X1&lt;/pre&gt;terms, the entire TOUCH_CAL_X1 component only needs to be calculated once.Second, you can trade out the arbitrary divide for a shift by preforming the divide ahead of time and shifting the result to avoid using floating point. Then undoing the shift whenever you use the value. The numbers are small enough that you shouldn’t have to worry about overflow when multiplying with a larger number… I think. i.e.&lt;pre class=&quot;code&quot;&gt;#define SHIFT 4static u16 scale_value = (CNTRL_WIDTH « SHIFT) / TOUCH_WIDTH;…(IPC-&gt;touchX * scale_value) » SHIFT …&lt;/pre&gt;Gotta look into compiler optimizations and figure out whether the above is worth the trouble if you specify -O2, etc." />
<meta property="og:description" content="Finally got some school stuff out of the way so I can get back to the important things in life…. like the Nintendo DS.Been messing around with touch-screen input a bit. It was fairly easy to get a demo running, but when I started trying to drag something around I found out that the touch screen uses a different coordinate system from the display. Dug around a little bit and came up with:&lt;pre class=&quot;code&quot;&gt;#define SCREEN_WIDTH 256#define SCREEN_HEIGHT 192// those are pixel positions of the two points you click // when calibrating#define TOUCH_CNTRL_X1 ((vu8)0x027FFCDC)#define TOUCH_CNTRL_Y1 ((vu8)0x027FFCDD)#define TOUCH_CNTRL_X2 ((vu8)0x027FFCE2)#define TOUCH_CNTRL_Y2 ((vu8)0x027FFCE3)// those are the corresponding touchscreen values:#define TOUCH_CAL_X1 ((vu16)0x027FFCD8)#define TOUCH_CAL_Y1 ((vu16)0x027FFCDA)#define TOUCH_CAL_X2 ((vu16)0x027FFCDE)#define TOUCH_CAL_Y2 ((vu16)0x027FFCE0)// linear mapping can be used to go from touchscreen position to // pixel position// precalculate some valuesstatic int16 TOUCH_WIDTH = TOUCH_CAL_X2 - TOUCH_CAL_X1;static int16 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;static int16 CNTRL_WIDTH = TOUCH_CNTRL_X2 - TOUCH_CNTRL_X1;static int16 CNTRL_HEIGHT = TOUCH_CNTRL_Y2 - TOUCH_CNTRL_Y1;// reading pixel position:int16 x = (IPC-&gt;touchX - (int16) TOUCH_CAL_X1) * CNTRL_WIDTH / TOUCH_WIDTH + (int16) TOUCH_CNTRL_X1;int16 y = (IPC-&gt;touchY - (int16) TOUCH_CAL_Y1) * CNTRL_HEIGHT / TOUCH_HEIGHT + (int16) TOUCH_CNTRL_Y1;&lt;/pre&gt;at NDSTech Wiki. The needed calibration values don’t seem to be in ndslib so I think you need to define them yourself. Took around a minute of messing around to get a nice demo working where you could drag something around on screen just like you’d expect.Something I did in my code that’s worth pointing out is changing the calculations a bit to get rid of any extra operations (especially the division). Granted, I’m not sure how much the compiler can take care of, but it probably doesn’t hurt.First, if you separate the&lt;pre class=&quot;code&quot;&gt;IPC-&gt;touchX - (int16) TOUCH_CAL_X1&lt;/pre&gt;terms, the entire TOUCH_CAL_X1 component only needs to be calculated once.Second, you can trade out the arbitrary divide for a shift by preforming the divide ahead of time and shifting the result to avoid using floating point. Then undoing the shift whenever you use the value. The numbers are small enough that you shouldn’t have to worry about overflow when multiplying with a larger number… I think. i.e.&lt;pre class=&quot;code&quot;&gt;#define SHIFT 4static u16 scale_value = (CNTRL_WIDTH « SHIFT) / TOUCH_WIDTH;…(IPC-&gt;touchX * scale_value) » SHIFT …&lt;/pre&gt;Gotta look into compiler optimizations and figure out whether the above is worth the trouble if you specify -O2, etc." />
<link rel="canonical" href="https://rendered-obsolete.bitbucket.io/2006/09/03/mapping-touch-screen-input-to-pixel.html" />
<meta property="og:url" content="https://rendered-obsolete.bitbucket.io/2006/09/03/mapping-touch-screen-input-to-pixel.html" />
<meta property="og:site_name" content="Rendered Obsolete" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-09-03T01:42:00+08:00" />
<script type="application/ld+json">
{"description":"Finally got some school stuff out of the way so I can get back to the important things in life…. like the Nintendo DS.Been messing around with touch-screen input a bit. It was fairly easy to get a demo running, but when I started trying to drag something around I found out that the touch screen uses a different coordinate system from the display. Dug around a little bit and came up with:&lt;pre class=&quot;code&quot;&gt;#define SCREEN_WIDTH 256#define SCREEN_HEIGHT 192// those are pixel positions of the two points you click // when calibrating#define TOUCH_CNTRL_X1 ((vu8)0x027FFCDC)#define TOUCH_CNTRL_Y1 ((vu8)0x027FFCDD)#define TOUCH_CNTRL_X2 ((vu8)0x027FFCE2)#define TOUCH_CNTRL_Y2 ((vu8)0x027FFCE3)// those are the corresponding touchscreen values:#define TOUCH_CAL_X1 ((vu16)0x027FFCD8)#define TOUCH_CAL_Y1 ((vu16)0x027FFCDA)#define TOUCH_CAL_X2 ((vu16)0x027FFCDE)#define TOUCH_CAL_Y2 ((vu16)0x027FFCE0)// linear mapping can be used to go from touchscreen position to // pixel position// precalculate some valuesstatic int16 TOUCH_WIDTH = TOUCH_CAL_X2 - TOUCH_CAL_X1;static int16 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;static int16 CNTRL_WIDTH = TOUCH_CNTRL_X2 - TOUCH_CNTRL_X1;static int16 CNTRL_HEIGHT = TOUCH_CNTRL_Y2 - TOUCH_CNTRL_Y1;// reading pixel position:int16 x = (IPC-&gt;touchX - (int16) TOUCH_CAL_X1) * CNTRL_WIDTH / TOUCH_WIDTH + (int16) TOUCH_CNTRL_X1;int16 y = (IPC-&gt;touchY - (int16) TOUCH_CAL_Y1) * CNTRL_HEIGHT / TOUCH_HEIGHT + (int16) TOUCH_CNTRL_Y1;&lt;/pre&gt;at NDSTech Wiki. The needed calibration values don’t seem to be in ndslib so I think you need to define them yourself. Took around a minute of messing around to get a nice demo working where you could drag something around on screen just like you’d expect.Something I did in my code that’s worth pointing out is changing the calculations a bit to get rid of any extra operations (especially the division). Granted, I’m not sure how much the compiler can take care of, but it probably doesn’t hurt.First, if you separate the&lt;pre class=&quot;code&quot;&gt;IPC-&gt;touchX - (int16) TOUCH_CAL_X1&lt;/pre&gt;terms, the entire TOUCH_CAL_X1 component only needs to be calculated once.Second, you can trade out the arbitrary divide for a shift by preforming the divide ahead of time and shifting the result to avoid using floating point. Then undoing the shift whenever you use the value. The numbers are small enough that you shouldn’t have to worry about overflow when multiplying with a larger number… I think. i.e.&lt;pre class=&quot;code&quot;&gt;#define SHIFT 4static u16 scale_value = (CNTRL_WIDTH « SHIFT) / TOUCH_WIDTH;…(IPC-&gt;touchX * scale_value) » SHIFT …&lt;/pre&gt;Gotta look into compiler optimizations and figure out whether the above is worth the trouble if you specify -O2, etc.","author":{"@type":"Person","name":"Contact:"},"@type":"BlogPosting","url":"https://rendered-obsolete.bitbucket.io/2006/09/03/mapping-touch-screen-input-to-pixel.html","headline":"Mapping touch-screen input to pixel values on the DS","dateModified":"2006-09-03T01:42:00+08:00","datePublished":"2006-09-03T01:42:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://rendered-obsolete.bitbucket.io/2006/09/03/mapping-touch-screen-input-to-pixel.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="https://rendered-obsolete.bitbucket.io/feed.xml" title="Rendered Obsolete" />
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Rendered Obsolete</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Mapping touch-screen input to pixel values on the DS</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-09-03T01:42:00+08:00" itemprop="datePublished">
        
        Sep 3, 2006
      </time>
      
        • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Contact:</span></span>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    Finally got some school stuff out of the way so I can get back to the important things in life.... like the Nintendo DS.<br /><br />Been messing around with touch-screen input a bit.  It was fairly easy to get a demo running, but when I started trying to drag something around I found out that the touch screen uses a different coordinate system from the display.  Dug around a little bit and came up with:<br /><br /><pre class="code"><br />#define SCREEN_WIDTH   256<br />#define SCREEN_HEIGHT   192<br /><br />// those are pixel positions of the two points you click <br />// when calibrating<br />#define TOUCH_CNTRL_X1   (*(vu8*)0x027FFCDC)<br />#define TOUCH_CNTRL_Y1   (*(vu8*)0x027FFCDD)<br />#define TOUCH_CNTRL_X2   (*(vu8*)0x027FFCE2)<br />#define TOUCH_CNTRL_Y2   (*(vu8*)0x027FFCE3)<br /><br />// those are the corresponding touchscreen values:<br />#define TOUCH_CAL_X1   (*(vu16*)0x027FFCD8)<br />#define TOUCH_CAL_Y1   (*(vu16*)0x027FFCDA)<br />#define TOUCH_CAL_X2   (*(vu16*)0x027FFCDE)<br />#define TOUCH_CAL_Y2   (*(vu16*)0x027FFCE0)<br /><br />// linear mapping can be used to go from touchscreen position to <br />// pixel position<br /><br />// precalculate some values<br />static int16 TOUCH_WIDTH  = TOUCH_CAL_X2 - TOUCH_CAL_X1;<br />static int16 TOUCH_HEIGHT = TOUCH_CAL_Y2 - TOUCH_CAL_Y1;<br />static int16 CNTRL_WIDTH  = TOUCH_CNTRL_X2 - TOUCH_CNTRL_X1;<br />static int16 CNTRL_HEIGHT = TOUCH_CNTRL_Y2 - TOUCH_CNTRL_Y1;<br /><br /><br />// reading pixel position:<br />int16 x = (IPC->touchX - (int16) TOUCH_CAL_X1) <br />    * CNTRL_WIDTH  / TOUCH_WIDTH  + (int16) TOUCH_CNTRL_X1;<br />int16 y = (IPC->touchY - (int16) TOUCH_CAL_Y1) <br />    * CNTRL_HEIGHT / TOUCH_HEIGHT + (int16) TOUCH_CNTRL_Y1;<br /></pre><br /><br />at <a href="http://www.bottledlight.com/ds/index.php/Misc/TouchScreen">NDSTech Wiki</a>.  The needed calibration values don't seem to be in ndslib so I think you need to define them yourself.  Took around a minute of messing around to get a nice demo working where you could drag something around on screen just like you'd expect.<br /><br />Something I did in my code that's worth pointing out is changing the calculations a bit to get rid of any extra operations (especially the division).  Granted, I'm not sure how much the compiler can take care of, but it probably doesn't hurt.<br /><br />First, if you separate the<br /><pre class="code">IPC->touchX - (int16) TOUCH_CAL_X1<br /></pre>terms, the entire TOUCH_CAL_X1 component only needs to be calculated once.<br /><br />Second, you can trade out the arbitrary divide for a shift by preforming the divide ahead of time and shifting the result to avoid using floating point.  Then undoing the shift whenever you use the value.  The numbers are small enough that you shouldn't have to worry about overflow when multiplying with a larger number... I think.  i.e.<br /><br /><pre class="code"><br />#define SHIFT 4<br />static u16 scale_value = (CNTRL_WIDTH << SHIFT) / TOUCH_WIDTH;<br />...<br />(IPC->touchX * scale_value) >> SHIFT ...<br /></pre><br /><br />Gotta look into compiler optimizations and figure out whether the above is worth the trouble if you specify -O2, etc.
  </div>

  

  <a class="u-url" href="/2006/09/03/mapping-touch-screen-input-to-pixel.html" hidden></a>
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Rendered Obsolete</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Rendered Obsolete
            
            </li>
            
            <li><a class="u-email" href="mailto:renderedobsolete@gmail.com">renderedobsolete@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  
  
  
  
  
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>A clever description for Google search results and RSS feed.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
